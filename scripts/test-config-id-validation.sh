#!/bin/bash

echo "üß™ Validando Config ID da Meta..."
echo "================================"

echo ""
echo "üìã Configura√ß√µes atuais:"
echo "========================"
echo "App ID: $(grep "META_APP_ID=" src/.env | cut -d'=' -f2)"
echo "Config ID: $(grep "META_APP_CONFIG_ID=" src/.env | cut -d'=' -f2)"
echo "Redirect URI: $(grep "META_REDIRECT_URI=" src/.env | cut -d'=' -f2)"
echo ""

echo "üîç Problema Identificado:"
echo "========================="
echo "‚ùå Config ID deveria permitir sele√ß√£o/cria√ß√£o de conta WhatsApp Business"
echo "‚ùå Mas estamos recebendo 'conta n√£o encontrada'"
echo "‚ùå Isso indica que o fluxo n√£o est√° funcionando corretamente"
echo ""

echo "üéØ Poss√≠veis Causas do Erro:"
echo "==========================="
echo "1. Config ID n√£o est√° ativo no Facebook Developer Console"
echo "2. Config ID n√£o est√° habilitado para Embedded Signup"
echo "3. Usu√°rio n√£o tem permiss√µes para criar contas WhatsApp Business"
echo "4. Facebook App em modo de desenvolvimento"
echo "5. Dom√≠nio n√£o autorizado no Config ID"
echo "6. Permiss√µes insuficientes no Facebook App"
echo ""

echo "üí° Verifica√ß√µes Necess√°rias:"
echo "==========================="
echo "1. No Facebook Developer Console:"
echo "   - Acesse: https://developers.facebook.com/"
echo "   - Seu App > Produtos > WhatsApp Business API"
echo "   - Configura√ß√µes > Cadastro incorporado"
echo "   - Verificar se o Config ID est√° 'Ativo'"
echo ""
echo "2. Verificar permiss√µes do Facebook App:"
echo "   - whatsapp_business_management (OBRIGAT√ìRIO)"
echo "   - whatsapp_business_messaging (OBRIGAT√ìRIO)"
echo "   - business_management (OBRIGAT√ìRIO)"
echo ""
echo "3. Verificar se o usu√°rio tem permiss√µes:"
echo "   - Deve ter permiss√µes para criar contas WhatsApp Business"
echo "   - Deve ser testador do Facebook App (se em modo desenvolvimento)"
echo ""

echo "üîß Teste de Valida√ß√£o:"
echo "====================="
echo "1. Acesse: https://localhost:5173"
echo "2. V√° para WhatsApp Credentials"
echo "3. Clique em 'Conectar com Facebook'"
echo "4. Observe no console do navegador:"
echo "   - 'üìã Configura√ß√µes Facebook:'"
echo "   - 'üöÄ Iniciando login com Config ID:'"
echo "   - 'üì± Resposta completa do Facebook:'"
echo "5. Verifique se o processo de Embedded Signup aparece"
echo "6. Verifique se consegue selecionar/criar conta WhatsApp Business"
echo ""

echo "üö® Se o problema persistir:"
echo "=========================="
echo "1. Verificar se o Config ID est√° ativo no Facebook Developer Console"
echo "2. Verificar se h√° restri√ß√µes de dom√≠nio no Config ID"
echo "3. Verificar se o usu√°rio tem permiss√µes para usar o Config ID"
echo "4. Verificar se o Facebook App est√° em modo de desenvolvimento"
echo "5. Adicionar usu√°rio como testador no Facebook App"
echo "6. Criar novo Config ID se necess√°rio"
echo ""

echo "üîó Links para Verifica√ß√£o:"
echo "========================="
echo "Facebook Developer Console: https://developers.facebook.com/"
echo "Meta Business Suite: https://business.facebook.com/wa/manage/accounts"
echo "WhatsApp Business API: https://developers.facebook.com/docs/whatsapp"
echo "Embedded Signup: https://developers.facebook.com/docs/whatsapp/embedded-signup"
echo ""

echo "üì± Pr√≥ximos Passos:"
echo "=================="
echo "1. Verificar configura√ß√£o do Config ID no Facebook Developer Console"
echo "2. Testar o fluxo completo e observar logs"
echo "3. Verificar se o processo de Embedded Signup aparece"
echo "4. Se n√£o aparecer, verificar configura√ß√µes do Facebook App"
echo "5. Se aparecer mas n√£o funcionar, verificar permiss√µes do usu√°rio"

