#!/bin/bash

echo "üîç Investiga√ß√£o Detalhada do Fluxo Config ID..."
echo "=============================================="

echo ""
echo "üìã Configura√ß√µes Atuais:"
echo "========================"
echo "App ID: $(grep "META_APP_ID=" src/.env | cut -d'=' -f2)"
echo "Config ID: $(grep "META_APP_CONFIG_ID=" src/.env | cut -d'=' -f2)"
echo "Redirect URI: $(grep "META_REDIRECT_URI=" src/.env | cut -d'=' -f2)"
echo ""

echo "üéØ Problema Identificado:"
echo "========================="
echo "‚ùå Config ID deveria permitir sele√ß√£o/cria√ß√£o de conta WhatsApp Business"
echo "‚ùå Mas estamos recebendo 'conta n√£o encontrada'"
echo "‚ùå Isso indica que o fluxo n√£o est√° funcionando corretamente"
echo ""

echo "üîç Poss√≠veis Causas:"
echo "==================="
echo "1. Config ID n√£o est√° configurado corretamente no Facebook Developer Console"
echo "2. Config ID n√£o est√° habilitado para Embedded Signup"
echo "3. Permiss√µes insuficientes no Facebook App"
echo "4. Fluxo do Config ID n√£o est√° sendo iniciado corretamente"
echo "5. Usu√°rio n√£o est√° completando o processo de Embedded Signup"
echo ""

echo "üí° Solu√ß√µes para Investigar:"
echo "============================"
echo "1. Verificar configura√ß√£o do Config ID no Facebook Developer Console:"
echo "   - V√° para: https://developers.facebook.com/"
echo "   - Seu App > Produtos > WhatsApp Business API"
echo "   - Configura√ß√µes > Cadastro incorporado"
echo "   - Verificar se o Config ID est√° ativo"
echo ""
echo "2. Verificar se o Config ID est√° habilitado:"
echo "   - Config ID deve estar em 'Ativo' ou 'Habilitado'"
echo "   - Verificar se h√° restri√ß√µes de dom√≠nio"
echo ""
echo "3. Testar fluxo manualmente:"
echo "   - Acessar: https://business.facebook.com/wa/manage/accounts"
echo "   - Verificar se consegue criar/gerenciar contas WhatsApp Business"
echo ""
echo "4. Verificar permiss√µes do Facebook App:"
echo "   - whatsapp_business_management (OBRIGAT√ìRIO)"
echo "   - whatsapp_business_messaging (OBRIGAT√ìRIO)"
echo "   - business_management (OBRIGAT√ìRIO)"
echo ""

echo "üîß Configura√ß√µes Necess√°rias no Facebook Developer Console:"
echo "=========================================================="
echo "1. App ID: $(grep "META_APP_ID=" src/.env | cut -d'=' -f2)"
echo "2. Config ID: $(grep "META_APP_CONFIG_ID=" src/.env | cut -d'=' -f2)"
echo "3. App Domains: localhost"
echo "4. Valid OAuth Redirect URIs: https://localhost:5173/"
echo "5. Produtos: WhatsApp Business API (ATIVO)"
echo "6. Configura√ß√µes > Cadastro incorporado: HABILITADO"
echo ""

echo "üì± Para Testar o Fluxo:"
echo "======================"
echo "1. Acesse: https://localhost:5173"
echo "2. V√° para WhatsApp Credentials"
echo "3. Clique em 'Conectar com Facebook'"
echo "4. Observe se o processo de Embedded Signup aparece"
echo "5. Verifique se consegue selecionar/criar conta WhatsApp Business"
echo "6. Complete todo o processo"
echo ""

echo "üîç Logs para Observar:"
echo "====================="
echo "1. No console do navegador:"
echo "   - Resposta completa do Facebook"
echo "   - C√≥digo de autoriza√ß√£o recebido"
echo "   - Permiss√µes concedidas"
echo ""
echo "2. No backend:"
echo "   - Troca de c√≥digo por access token"
echo "   - Busca de dados do usu√°rio"
echo "   - Tentativas de encontrar WhatsApp Business"
echo ""

echo "üö® Se o problema persistir:"
echo "=========================="
echo "1. Verificar se o Facebook App est√° em modo de desenvolvimento"
echo "2. Adicionar usu√°rio como testador no Facebook App"
echo "3. Verificar se h√° restri√ß√µes de dom√≠nio no Config ID"
echo "4. Testar com um Config ID diferente"
echo "5. Verificar se o usu√°rio tem permiss√µes para criar contas WhatsApp Business"
echo ""

echo "üîó Links √öteis:"
echo "=============="
echo "Facebook Developer Console: https://developers.facebook.com/"
echo "Meta Business Suite: https://business.facebook.com/wa/manage/accounts"
echo "WhatsApp Business API: https://developers.facebook.com/docs/whatsapp"
echo "Embedded Signup: https://developers.facebook.com/docs/whatsapp/embedded-signup"

